<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>DSTL</title>
<script src="home_files/jquery-1.9.1.min.js"></script>
<link rel="stylesheet" href="home_files/bootstrap.min.css">
<script async="" src="home_files/analytics.js"></script>
<script type="text/javascript">
 (function() {
  if (navigator.userAgent.match(/IEMobile\/10\.0/)) {
   var d = document, c = "appendChild", a = d.createElement("style");
   a[c](d.createTextNode("@-ms-viewport{width:auto!important}"));
   d.getElementsByTagName("head")[0][c](a);
  }
 })();
</script>
<link href="home_files/elements-page.css" rel="stylesheet" type="text/css">
<!--[if gt IE 8]><!-->
<link rel="stylesheet" media="screen" href="home_files/application.css">
<!--[if gt IE 8]><!-->
<link href="home_files/govuk-template-b5d680ad6607cf5441a22a3a533e92b40b15b8f6b9708dbdfc5fc6da71949113.css" media="screen" rel="stylesheet" type="text/css">
<!--<![endif]-->

<link href="home_files/govuk-template-print-e4515cc0129a011e04d70411d732b064ae130c10526c16fdab1159fb8bf3db0e.css" media="print" rel="stylesheet" type="text/css">


<!--[if gte IE 9]><!-->
<link href="home_files/fonts-5ff8c53913434afd0072a480d7cfca67cace4c8d03f6ef96b78a4455728ce745.css" media="all" rel="stylesheet" type="text/css">
<!--<![endif]-->
<link href="home_files/bootstrap.min.css" rel="stylesheet">

<!--[if lt IE 9]>
      <script src="https://assets.digital.cabinet-office.gov.uk/static/ie-105665c0105db53b92e57fabb90b0ef42b9034a0b8341beb3a20621a7f7eb4d3.js" type="text/javascript"></script>
    <![endif]-->

<link rel="shortcut icon" href="home_files/favicon-8d811b8c3badbc0b0e2f6e25d3660a96cc0cca7993e6f32e98785f205fc40907.ico" type="image/x-icon">

<!-- Size for iPad and iPad mini (high resolution) -->
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="home_files/apple-touch-icon-152x152-55dd2af7a53abb7dd14ba6a3c6c3fc786c57a074ba809f6dd767e186955a87e1.png">
<!-- Size for iPhone and iPod touch (high resolution) -->
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="home_files/apple-touch-icon-120x120-92580784afc35143f96b8cf5614e221427fdea444aeb13d912c879e884af7336.png">
<!-- Size for iPad 2 and iPad mini (standard resolution) -->
<link rel="apple-touch-icon-precomposed" sizes="76x76" href="home_files/apple-touch-icon-76x76-9b193f39cde53b92ba555efed856bcd103d6d1dc650919eb9f29dbe5f442cfb0.png">
<!-- Default non-defined size, also used for Android 2.1+ devices -->
<link rel="apple-touch-icon-precomposed" href="home_files/apple-touch-icon-60x60-0af0a7cf886701647210f13b661e607b7223bc3221b6d275718a89af79b3e7b9.png">

<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="og:image" content="home_files/opengraph-image-a1f7d89ffd0782738b1aeb0da37842d8bd0addbd724b8e58c3edbc7287cc11de.png">

<!--[if gt IE 8]><!-->
<link rel="stylesheet" media="screen" href="home_files/header-footer-only-d6e045da834b822ae2f553b2b28d90c947c076c1ca85e9f8f981175f2c918327.css">
<!--<![endif]-->

<link rel="stylesheet" media="print" href="home_files/header-footer-only-print-f22bccbf38170c0f2598e050f48db1a2c0649520c8f7900210f614264ecbcea8.css">


<!--[if gt IE 9]><!-->
<link rel="stylesheet" media="screen" href="home_files/base-1486e6b8b5983dd7b2b65782c6a6df354aa199af41aa8f509f1fd33948c87150.css">
<!--<![endif]-->
<link rel="stylesheet" media="print" href="home_files/print-d7bbf6e594aa2ff0ebbed133c3f65fdfe59e18be03d0713bb01d554c32444f18.css">
<link rel="alternate" type="application/atom+xml" title="Latest activity" href="home_files/defence-science-and-technology-laboratory.atom">
<link href="home_files/defence-science-and-technology-laboratory" rel="alternate" type="application/json">
<style>
p {
	margin: 20px;
	overflow: hidden;
	text-overflow: ellipsis;
	display: -webkit-box;
	-webkit-line-clamp: 3;
	-webkit-box-orient: vertical;
}
</style>
</head>

<body>
 <script type="text/javascript">
  document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');
 </script>

 <header role="banner" id="global-header" class=" with-proposition">
  <div class="header-wrapper">
   <div class="header-global"></div>

   <div class="header-proposition">

    <div class="content">
     <a href="#proposition-links" class="js-header-toggle menu">Menu</a>
     <nav id="proposition-menu">
      <a href="/dstl/index.html" id="proposition-name">DSTL</a>
      <ul id="proposition-links">
       <li><a href="config.html">Configuration</a></li>
       <li><a href="subscription.html">Subscription</a></li>
       <li><a class="active" href="index.html">Offline Search</a></li>
      </ul>
     </nav>
    </div>
   </div>
  </div>
 </header>
 <!--end header-->

 <div id="global-header-bar">
  <div class="inner-block">
   <div class="header-bar"></div>
  </div>
 </div>
 <!-- End -->

 <main id="content" role="main" class="group search">
 <div class="search-header">
  <div class="searchfield">
   <fieldset class="search-input">
    <label for="search-main">
     <h1>Search</h1>
    </label> <input type="search" name="search_text" value="" id="search-main">
   </fieldset>
   <fieldset class="search-submit">
    <button type="submit" id="search_button" class="button">Search</button>
   </fieldset>
  </div>
 </div>

 <div id="results" class="js-live-search-results-block" hidden>
  <div class="grid-row">
   <div class="column-third">
    <!--  <div aria-live="assertive" class="js-aria-live-count visuallyhidden">5 found</div> -->
    <div class="filter-form" id="facet_block">
     <div class="inner-block">
      <div id="filter-container">
       <p class="info">Filter by:</p>
       <!-- search filters-->
       <div class="filter checkbox-filter js-openable-filter" tabindex="0">
        <div class="head">
         <span class="legend">Search filters</span>
         <div class="controls">
          <a class="clear-selected  js-hidden">Search filter 1</a>
          <div class="toggle"></div>
         </div>
        </div>
        <div class="checkbox-container" id="Search filters" style="height: 72px;">
         <ul id="filter_list">
         </ul>
        </div>
       </div>
      </div>
      <!--End of search filters-->

      <div class="submit js-live-search-fallback">
       <input type="submit" class="button" value="Submit filters">
      </div>
     </div>
    </div>

   </div>
   <div class="column-two-thirds">

    <div class="results-block" id="search-result">
     <div class="inner-block js-live-search-results-list">
      <div class="result-count " id="js-live-search-result-count" aria-hidden="true">5 results found</div>
      <ol class="results-list" id="js-live-search-results" start="1">
      </ol>
      <ul class="previous-next-navigation">
      </ul>
     </div>
    </div>
   </div>
  </div>

 </div>
 </main>

 <div id="global-app-error" class="app-error hidden"></div>
 <footer class="group js-footer" id="footer" role="contentinfo">
  <div class="footer-wrapper">
   <div class="footer-meta"></div>
  </div>
 </footer>
 <!--end footer-->

 <script src="home_files/govuk-template-c4f303154d2a238bdda4d5cf1ebd8d4487822e4cbc3e4c83e743da869443ce72.js" type="text/javascript"></script>
 <script type="text/javascript">
  $(document).ready(function() {
   $("#search_button").click(function() {
    ajaxCall(null);
   });
  });

  function ajaxCall(map) {
   var search_text = $("#search-main").val();
   var facetFields = map;
   var dataToSend = {
    'queryString' : search_text,
    'cursor' : '*',
    'pageRows' : 5,
    'facetFields' : map
   };

   $.ajax({
    type : "POST",
    url : "/dstl/search",
    dataType : "json",
    contentType : "application/json; charset=utf-8",
    data : JSON.stringify(dataToSend),
    success : function(response) {

     populateQueryResult(response, search_text);
     if (null == map) {
      populateFilter(response);
     }
     $("#results").show();
     $("filter-container").hide();
    },
    error : function(error) {
     //alert(error.responseText);
    }
   });
  }

  function populateQueryResult(response, search_text) {
   $("#js-live-search-results").empty();
   var solrResponse = response.solrResponse;
   var result_count = solrResponse._results.length;
   var count_display = result_count + " results found for <b>" + search_text + "</b>";

   $("#js-live-search-result-count").html(count_display);
   for (i = 0; i < result_count; i++) {
    var url = solrResponse._results[i].url;
    var text = solrResponse._results[i].text;
    var docId = solrResponse._results[i].id;
    var title = solrResponse._results[i].title;
    var highlightedText = getHighLightedText(solrResponse, docId);
    console.log(solrResponse._highlighting[docId].text.length);
    $("#js-live-search-results").append("<li> <h3><a href="+url+">" + title + "</a></h3> <ul class=\"attributes\"></ul><p>" + highlightedText + "</p> </li>");
   }
  }

  function getHighLightedText(solrResponse, docoumentId) {
   var highlightedText = "";
   var highlightedMap = solrResponse._highlighting[docoumentId];
   for (j = 0; j < highlightedMap.text.length; j++) {
    highlightedText = highlightedText + "." + highlightedMap.text[j];
   }
   console.log(highlightedText);
   return highlightedText;
  }

  function populateFilter(response) {
   $("#filter-container").empty();
   var facetMap = response.solrResponse.facetFields
   for ( var key in facetMap) {
    var field_name = updateKey(key);
    if (facetMap.hasOwnProperty(key)) {
     var facetCountMap = facetMap[key];
     $("#filter-container").append("<div class=\"filter checkbox-filter js-openable-filter\" tabindex=\"0\" ><div class=\"head\"><span class=\"legend\">Search filter:" + key + "</span><div class=\"controls\"><a class=\"clear-selected  js-hidden\">Search filter 1</a><div class=\"toggle\"></div></div></div><div class=\"checkbox-container\" id=\"Search filters\" style=\"height: 72px;\"><ul id="+field_name+"><!-- dynamically generated HTML code based on facet result --><!-- <li><input type=\"checkbox\" name=\"Search filters[]\" value=\"Search filter 1\" id=\"Search-filter-1\"><label for=\"Search-filter-1\">filter 1</label></li><li><input type=\"checkbox\" name=\"Search filters[]\" value=\"Search filter 2\" id=\"Search-filter-2\"><label for=\"Search-filter-2\">Search filter 2</label></li> --></ul></div></div>");
     for ( var key1 in facetCountMap) {
      var field_li_name = updateKey("li_" + key1);
      var field_input_name = updateKey(key1);
      if (facetCountMap.hasOwnProperty(key1)) {
       $('#' + field_name).append("<li id="+field_li_name+"><input type=\"checkbox\" name=\"Search filters[]\" value=\"Search filter 1\" id=" + field_input_name + " onclick=\"add_checked(this);\"><label for="+field_input_name+">" + key1 + " (" + facetCountMap[key1] + ")</label></li>");
      }
     }
    }
   }
  }

  var map = {};
  var mapValues = new Array();
  function add_checked(el) {
   var parent1 = $(el).parent();
   var parent2 = $(parent1).parent();
   if (el.checked) {
    if (get($(parent1).parent().attr("id")) == undefined) {
     mapValues = new Array();
    }
    mapValues.push(updateKey1(el.id));
    map[parent2.attr("id")] = mapValues;
    ajaxCall(map);
   } else {
    removeKey(map, parent2.attr("id"), el);
    ajaxCall(map);
   }
  }
  function get(k) {
   return map[k];
  }

  function removeKey(obj, letter, el) {
   Object.keys(obj).forEach(function(key) {
    if (key.match(letter)) {
     var mapValues = obj[key];
     if (mapValues.length > 1) {
      mapValues.remove(updateKey1(el.id));
     } else if (mapValues.length <= 1) {
      delete obj[key];
     }
    }

   });
  }

  Array.prototype.remove = function() {
   var what, a = arguments, L = a.length, ax;
   while (L && this.length) {
    what = a[--L];
    while ((ax = this.indexOf(what)) !== -1) {
     this.splice(ax, 1);
    }
   }
   return this;
  };

  function updateKey(key) {

   key = key.replace(/ /g, "_");
   return key;
  }
  function updateKey1(key) {

   key = key.replace(/_/g, " ");
   return key;
  }
 </script>
</body>
</html>